<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>User Settings</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">

  <div class="bg-white shadow-xl rounded-2xl p-8 w-full max-w-md">
    <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">User Settings</h2>

    <div class="space-y-4">

      <!-- Profile Photo -->
      <div>
        <label class="block font-semibold text-gray-700 mb-1">Profile Photo</label>
        <input type="file" id="profilePhoto" accept="image/*" class="block w-full text-sm text-gray-600">
        <img id="previewPhoto" class="mt-3 w-24 h-24 rounded-full object-cover hidden" />
      </div>

      <!-- Phone Number -->
      <div>
        <label class="block font-semibold text-gray-700 mb-1">Phone Number</label>
        <input type="text" id="phone" placeholder="Enter phone number"
               class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none">
      </div>

      <!-- Location -->
      <div>
        <label class="block font-semibold text-gray-700 mb-1">Location</label>
        <div class="flex gap-2">
          <input type="text" id="location" placeholder="Click detect or enter manually"
                 class="flex-1 p-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none">
          <button id="detectLocation"
                  class="px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
            Detect
          </button>
        </div>
      </div>

      <!-- Save Button -->
      <button id="saveBtn"
              class="w-full py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700">
        Save Settings
      </button>

    </div>
    <p id="status" class="mt-4 text-center text-sm text-gray-600"></p>
  </div>

  <script>
    // ‚öôÔ∏è Replace this with your real Firebase config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // üìå Simulate logged in user (Replace with real auth logic)
    const userId = "demoUser123"; // Normally you'd use auth.currentUser.uid

    const status = document.getElementById("status");
    const photoInput = document.getElementById("profilePhoto");
    const previewPhoto = document.getElementById("previewPhoto");

    // Live preview of chosen profile photo
    photoInput.addEventListener("change", () => {
      const file = photoInput.files[0];
      if (file) {
        previewPhoto.src = URL.createObjectURL(file);
        previewPhoto.classList.remove("hidden");
      }
    });

    // üìç Detect user location using browser Geolocation API
    document.getElementById("detectLocation").addEventListener("click", () => {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const { latitude, longitude } = pos.coords;
            document.getElementById("location").value = `${latitude}, ${longitude}`;
          },
          () => alert("Unable to detect location.")
        );
      } else {
        alert("Geolocation not supported by your browser.");
      }
    });

    // üíæ Save settings
    document.getElementById("saveBtn").addEventListener("click", async () => {
      status.textContent = "Saving...";
      const phone = document.getElementById("phone").value;
      const location = document.getElementById("location").value;

      let photoURL = "";
      const file = photoInput.files[0];

      try {
        // Upload profile photo if chosen
        if (file) {
          const storageRef = storage.ref(`users/${userId}/profile.jpg`);
          await storageRef.put(file);
          photoURL = await storageRef.getDownloadURL();
        }

        // Save to Firestore
        await db.collection("users").doc(userId).set(
          {
            phone: phone || "",
            location: location || "",
            profilePhoto: photoURL || ""
          },
          { merge: true }
        );

        status.textContent = "‚úÖ Settings saved successfully!";
      } catch (err) {
        console.error(err);
        status.textContent = "‚ùå Error saving settings.";
      }
    });
  </script>
</body>
</html>
